<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Results – NYC 311 Service Requests Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./conclusion.html" rel="next">
<link href="./data.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b758ccaa5987ceb1b75504551e579abf.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-188a167a221c5957093c3a91812b996f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="site_libs/plotly-binding-4.11.0/plotly.js"></script>

<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>

<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>

<link href="site_libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">

<script src="site_libs/crosstalk-1.2.2/js/crosstalk.min.js"></script>

<link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">

<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>



</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./results_shweta.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Results</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">NYC 311 Service Requests Analysis</a> 
        <div class="sidebar-tools-main">
    <a href="https://shweta-3001.github.io/Group-15-NYC-311-Request-Edav-Project/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-git"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./results_shweta.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Results</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Conclusion</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#which-complaint-types-are-most-common-in-nyc" id="toc-which-complaint-types-are-most-common-in-nyc" class="nav-link active" data-scroll-target="#which-complaint-types-are-most-common-in-nyc"><span class="header-section-number">3.1</span> Which complaint types are most common in NYC?</a></li>
  <li><a href="#what-is-the-backlog-over-time-is-it-growing-or-shrinking" id="toc-what-is-the-backlog-over-time-is-it-growing-or-shrinking" class="nav-link" data-scroll-target="#what-is-the-backlog-over-time-is-it-growing-or-shrinking"><span class="header-section-number">3.2</span> What is the backlog over time? is it growing or shrinking?</a></li>
  <li><a href="#how-do-complaints-progress-through-the-system-which-types-get-stuck" id="toc-how-do-complaints-progress-through-the-system-which-types-get-stuck" class="nav-link" data-scroll-target="#how-do-complaints-progress-through-the-system-which-types-get-stuck"><span class="header-section-number">3.3</span> How do complaints progress through the system? which types get stuck?</a></li>
  <li><a href="#how-can-people-contact-311-which-channel-is-preferred-when" id="toc-how-can-people-contact-311-which-channel-is-preferred-when" class="nav-link" data-scroll-target="#how-can-people-contact-311-which-channel-is-preferred-when"><span class="header-section-number">3.4</span> How can people contact 311? which channel is preferred when?</a></li>
  <li><a href="#who-handles-what-interactive-boroughtypeagency-pair-plot" id="toc-who-handles-what-interactive-boroughtypeagency-pair-plot" class="nav-link" data-scroll-target="#who-handles-what-interactive-boroughtypeagency-pair-plot"><span class="header-section-number">3.5</span> Who handles what: interactive borough–type–agency “pair” plot</a></li>
  <li><a href="#where-problems-occur-and-what-type-of-complaints-are-occurring-there" id="toc-where-problems-occur-and-what-type-of-complaints-are-occurring-there" class="nav-link" data-scroll-target="#where-problems-occur-and-what-type-of-complaints-are-occurring-there"><span class="header-section-number">3.6</span> 3.6 Where problems occur, and what type of complaints are occurring there?</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://shweta-3001.github.io/Group-15-NYC-311-Request-Edav-Project/edit/main/results_shweta.qmd" class="toc-action"><i class="bi bi-git"></i>Edit this page</a></li><li><a href="https://shweta-3001.github.io/Group-15-NYC-311-Request-Edav-Project/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Results</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This section walks through what we actually <strong>see</strong> in the 311 data.<br>
Instead of repeating every statistic, we use a small set of plots where each one is meant to answer a specific question. For each figure, we describe:</p>
<ul>
<li>the main pattern in plain language<br>
</li>
<li>why that chart type was a good fit<br>
</li>
<li>what it suggests about how the 311 system is working.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<section id="which-complaint-types-are-most-common-in-nyc" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="which-complaint-types-are-most-common-in-nyc"><span class="header-section-number">3.1</span> Which complaint types are most common in NYC?</h2>
<p>There were a unique total of 300 complaint types reported in the dataset. The complaint were bucketed into the following categories for better analysis: Noise Related, Heat/Water/Gas Issues, Buildings and Housing, Sanitation and Waste, Street and Traffic Conditions, Public Safety / Crime / Quality of Life, Vehicle and Parking, Utilities and Power, Pests and Animals, Others / Miscellaneous.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df_clean_final <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"df_clean_final.rds"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>complaint_category_mapping <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Noise Related"</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Noise - Residential"</span>, <span class="st">"Noise - Street/Sidewalk"</span>, <span class="st">"Noise - Commercial"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Noise"</span>, <span class="st">"Noise - Vehicle"</span>, <span class="st">"Noise - Helicopter"</span>, <span class="st">"Noise - Park"</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Noise - House of Worship"</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Heat/Water/Gas Issues"</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HEAT/HOT WATER"</span>, <span class="st">"Water System"</span>, <span class="st">"WATER LEAK"</span>, <span class="st">"PLUMBING"</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Water Leak"</span>, <span class="st">"Drinking Water"</span>, <span class="st">"Water Quality"</span>, <span class="st">"Water Maintenance"</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Water Drainage"</span>, <span class="st">"Drinking Water General"</span>, <span class="st">"Drinking Water Tank"</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Drinking Water Conservation"</span>, <span class="st">"Bottled Water"</span>, <span class="st">"DEP Sidewalk Condition"</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Non-Residential Heat"</span>, <span class="st">"Heat/Hot Water"</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Buildings and Housing"</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PAINT/PLASTER"</span>, <span class="st">"DOOR/WINDOW"</span>, <span class="st">"FLOORING/STAIRS"</span>, <span class="st">"APPLIANCE"</span>,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Elevator"</span>, <span class="st">"Lead"</span>, <span class="st">"SAFETY"</span>, <span class="st">"Indoor Air Quality"</span>, <span class="st">"Plumbing"</span>,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Boilers"</span>, <span class="st">"Electrical"</span>, <span class="st">"ELEVATOR"</span>, <span class="st">"Asbestos"</span>, <span class="st">"Paint/Plaster"</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Door/Window"</span>, <span class="st">"OUTSIDE BUILDING"</span>, <span class="st">"Wood Pile"</span>, <span class="st">"Mold"</span>,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Flooring/Stairs"</span>, <span class="st">"Appliance"</span>, <span class="st">"Scaffold Safety"</span>, <span class="st">"Electric"</span>,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Unstable Building"</span>, <span class="st">"Window Guard"</span>, <span class="st">"Cooling Tower"</span>, <span class="st">"Peeling Paint"</span>,</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Facade Insp Safety Pgm"</span>, <span class="st">"Outside Building"</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Sanitation and Waste"</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"UNSANITARY CONDITION"</span>, <span class="st">"Dirty Condition"</span>, <span class="st">"Missed Collection"</span>,</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Residential Disposal Complaint"</span>, <span class="st">"Litter Basket Request"</span>,</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Commercial Disposal Complaint"</span>, <span class="st">"Litter Basket Complaint"</span>,</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sanitation Worker or Vehicle Complaint"</span>, <span class="st">"Dumpster Complaint"</span>,</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Industrial Waste"</span>, <span class="st">"Seasonal Collection"</span>, <span class="st">"Institution Disposal Complaint"</span>,</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Transfer Station Complaint"</span>, <span class="st">"DSNY Internal"</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Street and Traffic Conditions"</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Street Condition"</span>, <span class="st">"Traffic Signal Condition"</span>, <span class="st">"Street Light Condition"</span>,</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sidewalk Condition"</span>, <span class="st">"Curb Condition"</span>, <span class="st">"Street Sign - Damaged"</span>,</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Street Sign - Missing"</span>, <span class="st">"Street Sign - Dangling"</span>, <span class="st">"Highway Condition"</span>,</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Highway Sign - Damaged"</span>, <span class="st">"Highway Sign - Missing"</span>, <span class="st">"Highway Sign - Dangling"</span>,</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Bridge Condition"</span>, <span class="st">"Tunnel Condition"</span>, <span class="st">"DEP Highway Condition"</span>,</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">"DEP Street Condition"</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Public Safety / Crime / Quality of Life"</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Homeless Person Assistance"</span>, <span class="st">"Encampment"</span>, <span class="st">"Non-Emergency Police Matter"</span>,</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Drug Activity"</span>, <span class="st">"Graffiti"</span>, <span class="st">"Illegal Fireworks"</span>, <span class="st">"Panhandling"</span>,</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Animal-Abuse"</span>, <span class="st">"Violation of Park Rules"</span>, <span class="st">"Illegal Posting"</span>,</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Hazardous Materials"</span>, <span class="st">"Smoking"</span>, <span class="st">"Unleashed Dog"</span>, <span class="st">"Urinating in Public"</span>,</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Disorderly Youth"</span>, <span class="st">"Squeegee"</span>, <span class="st">"Quality of Life"</span>, <span class="st">"Face Covering Violation"</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Vehicle and Parking"</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Illegal Parking"</span>, <span class="st">"Blocked Driveway"</span>, <span class="st">"Abandoned Vehicle"</span>,</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Derelict Vehicles"</span>, <span class="st">"Broken Parking Meter"</span>, <span class="st">"Municipal Parking Facility"</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Utilities and Power"</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ELECTRIC"</span>, <span class="st">"Sewer"</span>, <span class="st">"Root/Sewer/Sidewalk Condition"</span>, <span class="st">"Radioactive Material"</span>,</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    <span class="st">"X-Ray Machine/Equipment"</span>, <span class="st">"Oil or Gas Spill"</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Pests and Animals"</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Rodent"</span>, <span class="st">"Animal in a Park"</span>, <span class="st">"Unsanitary Pigeon Condition"</span>,</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Harboring Bees/Wasps"</span>, <span class="st">"Illegal Animal Kept as Pet"</span>, <span class="st">"Mosquitoes"</span>,</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Pet Shop"</span>, <span class="st">"Poison Ivy"</span>, <span class="st">"Illegal Animal Sold"</span>, <span class="st">"Unsanitary Animal Facility"</span>,</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Animal Facility - No Permit"</span>, <span class="st">"Unlicensed Dog"</span>, <span class="st">"Unsanitary Animal Pvt Property"</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Others / Miscellaneous"</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>    <span class="st">"General Construction/Plumbing"</span>, <span class="st">"Illegal Dumping"</span>, <span class="st">"GENERAL"</span>,</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Damaged Tree"</span>, <span class="st">"Maintenance or Facility"</span>, <span class="st">"New Tree Request"</span>,</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>    <span class="st">"For Hire Vehicle Complaint"</span>, <span class="st">"Overgrown Tree/Branches"</span>, <span class="st">"Consumer Complaint"</span>,</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Vendor Enforcement"</span>, <span class="st">"Building/Use"</span>, <span class="st">"Obstruction"</span>, <span class="st">"Air Quality"</span>,</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Dead/Dying Tree"</span>, <span class="st">"Dead Animal"</span>, <span class="st">"Street Sweeping Complaint"</span>,</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Taxi Complaint"</span>, <span class="st">"Lost Property"</span>, <span class="st">"Outdoor Dining"</span>,</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Real Time Enforcement"</span>, <span class="st">"Mobile Food Vendor"</span>, <span class="st">"Bike/Roller/Skate"</span>,</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Chronic"</span>, <span class="st">"Special Projects Inspection Team (SPIT)"</span>, <span class="st">"Illegal Tree Damage"</span>,</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Electronics Waste Appointment"</span>, <span class="st">"Emergency Response Team (ERT)"</span>,</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Food Poisoning"</span>, <span class="st">"Smoking or Vaping"</span>, <span class="st">"Day Care"</span>, <span class="st">"Standing Water"</span>,</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Investigations and Discipline (IAD)"</span>, <span class="st">"Remaining Taxi Report"</span>,</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>    <span class="st">"E-Scooter"</span>, <span class="st">"BEST/Site Safety"</span>, <span class="st">"Indoor Sewage"</span>, <span class="st">"For Hire Vehicle Report"</span>,</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Uprooted Stump"</span>, <span class="st">"Green Taxi Complaint"</span>, <span class="st">"Ferry Inquiry"</span>, <span class="st">"Ferry Complaint"</span>,</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Beach/Pool/Sauna Complaint"</span>, <span class="st">"Tattooing"</span>, <span class="st">"Plant"</span>, <span class="st">"Bus Stop Shelter Placement"</span>,</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>    <span class="st">"LinkNYC"</span>, <span class="st">"Bus Stop Shelter Complaint"</span>, <span class="st">"Posting Advertisement"</span>,</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Taxi Compliment"</span>, <span class="st">"AHV Inspection Unit"</span>, <span class="st">"Adopt-A-Basket"</span>,</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Cranes and Derricks"</span>, <span class="st">"Recycling Basket Complaint"</span>, <span class="st">"Found Property"</span>,</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Incorrect Data"</span>, <span class="st">"Bike Rack"</span>, <span class="st">"Special Natural Area District (SNAD)"</span>,</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Public Toilet"</span>, <span class="st">"Dept of Investigations"</span>, <span class="st">"Lifeguard"</span>, <span class="st">"Special Operations"</span>,</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Dispatched Taxi Complaint"</span>, <span class="st">"Boiler"</span>, <span class="st">"Bench"</span>, <span class="st">"Building Condition"</span>,</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Taxi Licensee Complaint"</span>, <span class="st">"Retailer Complaint"</span>, <span class="st">"Calorie Labeling"</span>,</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ZTESTINT"</span>, <span class="st">"Public Payphone Complaint"</span>, <span class="st">"FHV Licensee Complaint"</span>,</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Wayfinding SNW"</span>, <span class="st">"Leaning"</span>, <span class="st">"Bar"</span>, <span class="st">"Building Marshal's Office"</span>,</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Building Marshals office"</span>, <span class="st">"DOB Posted Notice or Order"</span>,</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Construction Safety Enforcement"</span>, <span class="st">"Tanning"</span>, <span class="st">"Executive Inspections"</span>,</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Internal"</span>, <span class="st">"Code"</span>, <span class="st">"Private School"</span>, <span class="st">"Vaccine Mandate Non-Compliance"</span>,</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Dispatched Taxi Compliment"</span>, <span class="st">"SRDE"</span>, <span class="st">"Stalled Sites"</span>,</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sustainability Enforcement"</span>, <span class="st">"Trans Fat"</span>, <span class="st">"Food Establishment"</span>,</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sewer Maintenance"</span>, <span class="st">"Bike Rack Condition"</span>, <span class="st">"Construction Lead Dust"</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a long-format data frame</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>complaint_mapping_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>  <span class="at">complaint_type =</span> <span class="fu">unlist</span>(complaint_category_mapping),</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>  <span class="at">category =</span> <span class="fu">rep</span>(<span class="fu">names</span>(complaint_category_mapping), </span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">sapply</span>(complaint_category_mapping, length)),</span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(complaint_mapping_df) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>map_complaint_to_category <span class="ot">&lt;-</span> <span class="cf">function</span>(complaint_type) {</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (category <span class="cf">in</span> <span class="fu">names</span>(complaint_category_mapping)) {</span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (complaint_type <span class="sc">%in%</span> complaint_category_mapping[[category]]) {</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(category)</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="st">"Others / Miscellaneous"</span>)</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the mapping to create complaint_bucket column</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>df_clean_final <span class="ot">&lt;-</span> df_clean_final <span class="sc">|&gt;</span></span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">complaint_bucket =</span> <span class="fu">sapply</span>(complaint_type, map_complaint_to_category))</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>complaint_bucket_counts <span class="ot">&lt;-</span> df_clean_final <span class="sc">|&gt;</span></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(complaint_bucket, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>complaint_bucket_borough <span class="ot">&lt;-</span> df_clean_final <span class="sc">|&gt;</span></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(borough, complaint_bucket) <span class="sc">|&gt;</span></span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(borough) <span class="sc">|&gt;</span></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_borough =</span> <span class="fu">sum</span>(count),</span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>    <span class="at">proportion =</span> count <span class="sc">/</span> total_borough <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(complaint_bucket_borough)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 5
   borough complaint_bucket                       count total_borough proportion
   &lt;chr&gt;   &lt;chr&gt;                                  &lt;int&gt;         &lt;int&gt;      &lt;dbl&gt;
 1 BRONX   Buildings and Housing                 152187       1365908      11.1 
 2 BRONX   Heat/Water/Gas Issues                 280270       1365908      20.5 
 3 BRONX   Noise Related                         354903       1365908      26.0 
 4 BRONX   Others / Miscellaneous                105631       1365908       7.73
 5 BRONX   Pests and Animals                      14932       1365908       1.09
 6 BRONX   Public Safety / Crime / Quality of L…  32185       1365908       2.36
 7 BRONX   Sanitation and Waste                  107341       1365908       7.86
 8 BRONX   Street and Traffic Conditions          49349       1365908       3.61
 9 BRONX   Utilities and Power                    28127       1365908       2.06
10 BRONX   Vehicle and Parking                   240983       1365908      17.6 
# ℹ 40 more rows</code></pre>
</div>
</div>
<p>To see how concerns differ across boroughs, we turned these counts into <strong>within-borough percentages</strong> and plotted them as a <strong>Cleveland dot plot</strong>, faceted by borough.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare plot data: percent label and reorder within each borough</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>plot_df <span class="ot">&lt;-</span> complaint_bucket_borough <span class="sc">|&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop_label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(proportion, <span class="dv">1</span>), <span class="st">"%"</span>),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">complaint_bucket =</span> <span class="fu">reorder_within</span>(complaint_bucket, proportion, borough, <span class="at">fun =</span> max))</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Cleveland dot-plot showing proportion (%) and ordered by highest per borough</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_df, <span class="fu">aes</span>(<span class="at">x =</span> proportion, <span class="at">y =</span> complaint_bucket)) <span class="sc">+</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">xend =</span> proportion, <span class="at">yend =</span> complaint_bucket),</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"gray80"</span>) <span class="sc">+</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> borough), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> borough, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">paste0</span>(x, <span class="st">"%"</span>)) <span class="sc">+</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reordered</span>() <span class="sc">+</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set2"</span>) <span class="sc">+</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">5</span>, <span class="dv">30</span>, <span class="dv">5</span>, <span class="dv">5</span>) <span class="co"># room for labels</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Complaint Categories by Borough (Cleveland dot plot)"</span>,</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Proportion of complaints by category within each borough"</span>,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Proportion (%)"</span>,</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Complaint Category"</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">clip =</span> <span class="st">"off"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="results_shweta_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>We choose Cleveland dot plot because with ~10 complaint buckets and 5 boroughs, a standard grouped bar chart would be wide and cluttered.<br>
</li>
<li>A dot plot puts all categories on a shared horizontal scale (0–30%), which makes it easier to compare both <strong>within</strong> a borough and <strong>across</strong> boroughs.</li>
</ul>
<p><strong>What stands out</strong></p>
<ul>
<li>In every borough, <strong>Noise Related</strong> and <strong>Vehicle and Parking</strong> are among the top categories by share, often together making up roughly one-third of complaints.<br>
</li>
<li><strong>Manhattan</strong> is particularly noise-heavy, which matches expectations for a dense, mixed-use borough with late-night activity.</li>
<li><strong>Staten Island</strong> shows relatively more <em>Street and Traffic Conditions</em> and <em>Vehicle and Parking</em> complaints, consistent with a more car-reliant area.<br>
</li>
<li>Buckets like <em>Pests and Animals</em> or <em>Utilities and Power</em> appear as small but visible shares everywhere; the dot plot keeps them from disappearing into an “Other” bucket. ## To quantify how “caught up” the city is, we approximated a <strong>daily backlog</strong>:</li>
</ul>
<blockquote class="blockquote">
<p>backlog(date) ≈ cumulative complaints created − cumulative complaints closed.</p>
</blockquote>
<p>We plotted this as an <strong>area chart</strong> over the full time window.</p>
</section>
<section id="what-is-the-backlog-over-time-is-it-growing-or-shrinking" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="what-is-the-backlog-over-time-is-it-growing-or-shrinking"><span class="header-section-number">3.2</span> What is the backlog over time? is it growing or shrinking?</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df_clean_final   <span class="co"># or your df name</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Get overall date range from created_date -------------------------------</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>date_range <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">min</span>(<span class="fu">as.Date</span>(created_date), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">end   =</span> <span class="fu">max</span>(<span class="fu">as.Date</span>(created_date), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Build daily backlog table using ONLY |&gt; --------------------------------</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>backlog <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">created_date =</span> <span class="fu">as.Date</span>(created_date),</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">closed_date  =</span> <span class="fu">as.Date</span>(closed_date)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># daily counts of created</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(created_date, <span class="at">name =</span> <span class="st">"n_created"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">date =</span> <span class="fu">seq</span>(</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">from =</span> date_range<span class="sc">$</span>start,</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">to   =</span> date_range<span class="sc">$</span>end,</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">by   =</span> <span class="st">"day"</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"created_date"</span> <span class="ot">=</span> <span class="st">"date"</span>)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">date =</span> created_date) <span class="sc">|&gt;</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_created =</span> <span class="fu">replace_na</span>(n_created, <span class="dv">0</span>L)) <span class="sc">|&gt;</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># daily counts of closed</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">|&gt;</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(closed_date)) <span class="sc">|&gt;</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">transmute</span>(<span class="at">closed_date =</span> <span class="fu">as.Date</span>(closed_date)) <span class="sc">|&gt;</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>      <span class="fu">count</span>(closed_date, <span class="at">name =</span> <span class="st">"n_closed"</span>),</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span> <span class="ot">=</span> <span class="st">"closed_date"</span>)</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_closed    =</span> <span class="fu">replace_na</span>(n_closed, <span class="dv">0</span>L),</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_created =</span> <span class="fu">cumsum</span>(n_created),</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_closed  =</span> <span class="fu">cumsum</span>(n_closed),</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">open_backlog =</span> cum_created <span class="sc">-</span> cum_closed</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Plot -------------------------------------------------------------------</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>caption_text <span class="ot">&lt;-</span> <span class="fu">paste</span>(</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Backlog shows how many cases are open each day."</span>,</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>  <span class="st">"A rising line means new cases are arriving faster than they close (growing backlog);"</span>,</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>  <span class="st">"a flat or falling line means the city is catching up."</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>p_backlog <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(backlog, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> open_backlog)) <span class="sc">+</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Open cases (backlog)"</span>,</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">label_number</span>(<span class="at">scale_cut =</span> <span class="fu">cut_short_scale</span>(), <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">"2 months"</span>,</span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">"%b %Y"</span></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">title    =</span> <span class="st">"Backlog over time (system stress)"</span>,</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Number of open cases each day; different from resolution time"</span>,</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption  =</span> caption_text</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>p_backlog</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="results_shweta_files/figure-html/backlog-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
<p><strong>What the backlog curve tells us</strong></p>
<ul>
<li>Backlog starts close to zero and <strong>climbs steadily</strong> throughout 2023 and 2024.<br>
</li>
<li>There are short flat spots and small dips, but no long period where the city clearly catches up; by early 2025, the estimated backlog is near the 300k mark.<br>
</li>
<li>This means that even if individual cases close in reasonable time, <strong>new complaints</strong> have been arriving faster than they are resolved , leaving a growing stock of open work. The backlog plot is our main evidence that the 311 system is <strong>under sustained pressure</strong> rather than just dealing with a one-off spike.</li>
</ul>
</section>
<section id="how-do-complaints-progress-through-the-system-which-types-get-stuck" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="how-do-complaints-progress-through-the-system-which-types-get-stuck"><span class="header-section-number">3.3</span> How do complaints progress through the system? which types get stuck?</h2>
<p>Next we look at what happens <em>after</em> a complaint is created.<br>
The alluvial (Sankey-style) diagram follows the volume of complaints from:</p>
<blockquote class="blockquote">
<p><strong>Year (2023 vs 2024) → Complaint Type (bucket) → Final Status<br>
(Assigned, Closed, In Progress)</strong></p>
</blockquote>
<p>Each band’s thickness represents the number of complaints flowing along that path.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggalluvial)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare alluvial data</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>df_viz <span class="ot">&lt;-</span> df_clean_final <span class="sc">|&gt;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">year</span>(created_date),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">floor_date</span>(created_date, <span class="st">"month"</span>),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">status_clean =</span> <span class="fu">ifelse</span>(status <span class="sc">==</span> <span class="st">""</span>, <span class="cn">NA</span>, status)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>df_alluvial <span class="ot">&lt;-</span> df_viz <span class="sc">|&gt;</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(status_clean)) <span class="sc">|&gt;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(year, complaint_bucket, status_clean)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Alluvial Plot</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  df_alluvial,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis1 =</span> year,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis2 =</span> complaint_bucket,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis3 =</span> status_clean,</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> n</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_alluvium</span>(<span class="fu">aes</span>(<span class="at">fill =</span> complaint_bucket), <span class="at">width =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stratum</span>(<span class="at">width =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">"stratum"</span>,</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">after_stat</span>(stratum)),</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"white"</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="st">"Year"</span>, <span class="st">"Complaint Type"</span>, <span class="st">"Status"</span>),</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">05</span>, .<span class="dv">05</span>)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Complaint Flow: Year → Complaint Type → Final Status"</span>,</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"How complaints evolve from originating year to type to closure state"</span>,</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Complaints"</span>,</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="results_shweta_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p><strong>Main patterns</strong></p>
<ul>
<li>2023 bands are thicker than 2024 simply because more months of 2023 are in the data.<br>
</li>
<li>For most buckets, the majority of complaints eventually flow into <strong>Closed</strong>, but the share that remains <strong>Assigned</strong> or <strong>In Progress</strong> varies by type.<br>
</li>
<li>Complaint buckets such as <strong>Buildings and Housing</strong> and <strong>Sanitation and Waste</strong> send a larger fraction of their volume into <strong>Assigned</strong> or <strong>In Progress</strong> compared to, say, <strong>Noise</strong> or <strong>Vehicle and Parking</strong>. That suggests more complex or slower workflows for physical-infrastructure issues.This plot gives a <strong>big-picture map of the complaint lifecycle</strong>, highlighting which categories tend to linger in the system.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional but recommended for big data speed:</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># library(data.table)</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>theme_report <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">18</span>),</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df_clean_final <span class="sc">|&gt;</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">created_dt  =</span> <span class="fu">ymd_hms</span>(created_date, <span class="at">quiet =</span> <span class="cn">TRUE</span>, <span class="at">tz =</span> <span class="st">"America/New_York"</span>),</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">closed_dt   =</span> <span class="fu">ymd_hms</span>(closed_date,  <span class="at">quiet =</span> <span class="cn">TRUE</span>, <span class="at">tz =</span> <span class="st">"America/New_York"</span>),</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">updated_dt  =</span> <span class="fu">ymd_hms</span>(resolution_action_updated_date, <span class="at">quiet =</span> <span class="cn">TRUE</span>, <span class="at">tz =</span> <span class="st">"America/New_York"</span>),</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">date        =</span> <span class="fu">as_date</span>(created_dt),</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">month       =</span> <span class="fu">floor_date</span>(created_dt, <span class="st">"month"</span>),</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">hour        =</span> <span class="fu">hour</span>(created_dt),</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">wday        =</span> <span class="fu">wday</span>(created_dt, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">week_start =</span> <span class="dv">1</span>),</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_closed   =</span> <span class="sc">!</span><span class="fu">is.na</span>(closed_dt),</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">ttc_hours   =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(closed_dt, created_dt, <span class="at">units =</span> <span class="st">"hours"</span>)),</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">ttc_days    =</span> ttc_hours <span class="sc">/</span> <span class="dv">24</span>,</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_geo     =</span> <span class="sc">!</span><span class="fu">is.na</span>(latitude) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(longitude)</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(created_dt))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="how-can-people-contact-311-which-channel-is-preferred-when" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="how-can-people-contact-311-which-channel-is-preferred-when"><span class="header-section-number">3.4</span> How can people contact 311? which channel is preferred when?</h2>
<p>How people submit complaints: ONLINE, PHONE, MOBILE, and OTHER.For each time-of-day shift (Late Night, Morning, Afternoon, Evening), we calculated each channel’s <strong>share of monthly complaints</strong> and plotted these as <strong>line charts in a 2×2 facet layout</strong>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(slider)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Build shift + month, clean channel ---</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    created_date,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">open_data_channel_type =</span> <span class="fu">str_squish</span>(open_data_channel_type)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(open_data_channel_type),</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    open_data_channel_type <span class="sc">!=</span> <span class="st">""</span>,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">str_to_lower</span>(open_data_channel_type) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"unknown"</span>,<span class="st">"unk"</span>,<span class="st">"n/a"</span>,<span class="st">"na"</span>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">created_dt =</span> <span class="fu">ymd_hms</span>(created_date, <span class="at">quiet =</span> <span class="cn">TRUE</span>, <span class="at">tz =</span> <span class="st">"America/New_York"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(created_dt)) <span class="sc">|&gt;</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">floor_date</span>(created_dt, <span class="st">"month"</span>),</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">hr =</span> <span class="fu">hour</span>(created_dt),</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">shift =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>      hr <span class="sc">&lt;</span> <span class="dv">6</span>  <span class="sc">~</span> <span class="st">"Late Night"</span>,</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>      hr <span class="sc">&lt;</span> <span class="dv">12</span> <span class="sc">~</span> <span class="st">"Morning"</span>,</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>      hr <span class="sc">&lt;</span> <span class="dv">18</span> <span class="sc">~</span> <span class="st">"Afternoon"</span>,</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span>    <span class="sc">~</span> <span class="st">"Evening"</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">shift =</span> <span class="fu">factor</span>(shift, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Late Night"</span>,<span class="st">"Morning"</span>,<span class="st">"Afternoon"</span>,<span class="st">"Evening"</span>))</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Top 4 channels only ---</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>top4 <span class="ot">&lt;-</span> cm <span class="sc">|&gt;</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(open_data_channel_type, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">4</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(open_data_channel_type)</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> cm <span class="sc">|&gt;</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(open_data_channel_type <span class="sc">%in%</span> top4) <span class="sc">|&gt;</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">channel =</span> <span class="fu">fct_relevel</span>(open_data_channel_type, top4))</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Monthly share within each shift + 3-month rolling average ---</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>channel_shift_month <span class="ot">&lt;-</span> cm <span class="sc">|&gt;</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(month, shift, channel, <span class="at">name =</span> <span class="st">"n"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month, shift) <span class="sc">|&gt;</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">share =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">|&gt;</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(shift, channel, month) <span class="sc">|&gt;</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(shift, channel) <span class="sc">|&gt;</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">share_roll3 =</span> <span class="fu">slide_dbl</span>(share, mean, <span class="at">.before =</span> <span class="dv">1</span>, <span class="at">.after =</span> <span class="dv">1</span>, <span class="at">.complete =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Plot (matches your screenshot; legend on the right) ---</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>p_shift_channel <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>  channel_shift_month,</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">group =</span> channel, <span class="at">color =</span> channel)</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> share), <span class="at">linewidth =</span> <span class="fl">0.7</span>, <span class="at">alpha =</span> <span class="fl">0.30</span>) <span class="sc">+</span>        <span class="co"># thin monthly</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> share_roll3), <span class="at">linewidth =</span> <span class="fl">1.35</span>, <span class="at">alpha =</span> <span class="fl">0.95</span>) <span class="sc">+</span> <span class="co"># thick roll avg</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> shift, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">"fixed"</span>) <span class="sc">+</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.60</span>),</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.60</span>, <span class="at">by =</span> <span class="fl">0.20</span>),</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>),</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>))</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">"4 months"</span>,</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">"%b %Y"</span>,</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.05</span>))</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"311 Submission Channels by Time-of-Day Shift"</span>,</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Channel composition varies by shift; thick lines show 3-month rolling averages to clarify trend direction (Top 4 channels; Unknown removed)."</span>,</span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Share of monthly complaints"</span>,</span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Channel"</span></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="fl">1.4</span>, <span class="st">"lines"</span>),</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"grey92"</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">14</span>, <span class="at">r =</span> <span class="dv">18</span>, <span class="at">b =</span> <span class="dv">14</span>, <span class="at">l =</span> <span class="dv">30</span>),</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># legend on the right</span></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="fl">0.9</span>, <span class="st">"lines"</span>),</span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.width  =</span> <span class="fu">unit</span>(<span class="fl">1.0</span>, <span class="st">"lines"</span>)</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a>p_shift_channel</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="results_shweta_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
<p><strong>Behavioural shifts we see</strong></p>
<ul>
<li>In the <strong>Late Night</strong> panel, ONLINE starts out dominant, but its share falls while MOBILE rises sharply, eventually becoming comparable or higher. Night-time reporting is increasingly app-based.<br>
</li>
<li>During <strong>Morning</strong> and <strong>Afternoon</strong>, PHONE remains important, but MOBILE’s share inches up over the two years.<br>
</li>
<li><strong>Evening</strong> shows the most balanced mix, with ONLINE still strong but MOBILE gaining ground.</li>
</ul>
<p>Taken together, these lines point to a <strong>slow but clear shift towards mobile reporting</strong>, especially outside office hours, which has implications for how interfaces and follow-up communication should be designed.</p>
</section>
<section id="who-handles-what-interactive-boroughtypeagency-pair-plot" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="who-handles-what-interactive-boroughtypeagency-pair-plot"><span class="header-section-number">3.5</span> Who handles what: interactive borough–type–agency “pair” plot</h2>
<p>To connect complaints to the agencies that act on them, we built an <strong>interactive Sankey diagram</strong> with four stages:</p>
<blockquote class="blockquote">
<p><strong>Borough → Detailed Complaint Type → Agency → Status</strong></p>
</blockquote>
<p>This is the plot we think of as a <strong>pair-exploration tool</strong>: users can focus on one borough–type, type–agency, or agency–status “pair” at a time.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> df_clean_final <span class="sc">|&gt;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">borough        =</span> <span class="fu">fct_lump_n</span>(<span class="fu">factor</span>(borough), <span class="dv">5</span>, <span class="at">other_level =</span> <span class="st">"Other"</span>),</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">complaint_type =</span> <span class="fu">fct_lump_n</span>(<span class="fu">factor</span>(complaint_type), <span class="dv">10</span>, <span class="at">other_level =</span> <span class="st">"Other"</span>),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">agency_name    =</span> <span class="fu">fct_lump_n</span>(<span class="fu">factor</span>(agency_name), <span class="dv">10</span>, <span class="at">other_level =</span> <span class="st">"Other"</span>),</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">status         =</span> <span class="fu">fct_lump_n</span>(<span class="fu">factor</span>(status), <span class="dv">6</span>, <span class="at">other_level =</span> <span class="st">"Other"</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">drop_na</span>(borough, complaint_type, agency_name, status) <span class="sc">|&gt;</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    borough <span class="sc">!=</span> <span class="st">"Other"</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    complaint_type <span class="sc">!=</span> <span class="st">"Other"</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    agency_name <span class="sc">!=</span> <span class="st">"Other"</span>,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    status <span class="sc">!=</span> <span class="st">"Other"</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>d_counts <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(borough, complaint_type, agency_name, status, <span class="at">name =</span> <span class="st">"n"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">|&gt;</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">borough_id =</span> <span class="fu">as.integer</span>(borough))</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>borough_levels <span class="ot">&lt;-</span> <span class="fu">levels</span>(d_counts<span class="sc">$</span>borough)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="fu">length</span>(borough_levels)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>pal5 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#0072B2"</span>, <span class="st">"#D55E00"</span>, <span class="st">"#009E73"</span>, <span class="st">"#CC79A7"</span>, <span class="st">"#F0E442"</span>)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>discrete_scale <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="dv">0</span><span class="sc">/</span><span class="dv">4</span>, pal5[<span class="dv">1</span>]), <span class="fu">list</span>(<span class="dv">0</span><span class="sc">/</span><span class="dv">4</span>, pal5[<span class="dv">1</span>]),</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, pal5[<span class="dv">2</span>]), <span class="fu">list</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, pal5[<span class="dv">2</span>]),</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="dv">2</span><span class="sc">/</span><span class="dv">4</span>, pal5[<span class="dv">3</span>]), <span class="fu">list</span>(<span class="dv">2</span><span class="sc">/</span><span class="dv">4</span>, pal5[<span class="dv">3</span>]),</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>, pal5[<span class="dv">4</span>]), <span class="fu">list</span>(<span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>, pal5[<span class="dv">4</span>]),</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="dv">4</span><span class="sc">/</span><span class="dv">4</span>, pal5[<span class="dv">5</span>]), <span class="fu">list</span>(<span class="dv">4</span><span class="sc">/</span><span class="dv">4</span>, pal5[<span class="dv">5</span>])</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>fig_parcats <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"parcats"</span>,</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">1100</span>, <span class="at">height =</span> <span class="dv">650</span>,</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">arrangement =</span> <span class="st">"freeform"</span>,</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimensions =</span> <span class="fu">list</span>(</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"Borough"</span>,        <span class="at">values =</span> d_counts<span class="sc">$</span>borough),</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"Complaint Type"</span>, <span class="at">values =</span> d_counts<span class="sc">$</span>complaint_type),</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"Agency"</span>,         <span class="at">values =</span> d_counts<span class="sc">$</span>agency_name),</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"Status"</span>,         <span class="at">values =</span> d_counts<span class="sc">$</span>status)</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">counts =</span> d_counts<span class="sc">$</span>n,</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">line =</span> <span class="fu">list</span>(</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> d_counts<span class="sc">$</span>borough_id,</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">colorscale =</span> discrete_scale,</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">cmin =</span> <span class="dv">1</span>, <span class="at">cmax =</span> K,</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">showscale =</span> <span class="cn">FALSE</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>  plotly<span class="sc">::</span><span class="fu">layout</span>(</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">list</span>(</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="st">"311 Complaint Flow: Borough → Type → Agency → Status (Colored by Borough)"</span>,</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fl">0.02</span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">margin =</span> <span class="fu">list</span>(<span class="at">l =</span> <span class="dv">40</span>, <span class="at">r =</span> <span class="dv">40</span>, <span class="at">t =</span> <span class="dv">60</span>, <span class="at">b =</span> <span class="dv">30</span>)</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>fig_parcats</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="htmlwidget-31184df84d7c70283f9b" style="width:100%;height:384px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-31184df84d7c70283f9b">{"x":{"visdat":{"f24856aa390c":["function () ","plotlyVisDat"]},"cur_data":"f24856aa390c","attrs":{"f24856aa390c":{"arrangement":"freeform","dimensions":[{"label":"Borough","values":["BROOKLYN","QUEENS","BRONX","BROOKLYN","BRONX","BRONX","QUEENS","QUEENS","MANHATTAN","BROOKLYN","BROOKLYN","MANHATTAN","MANHATTAN","MANHATTAN","BRONX","BRONX","BROOKLYN","BROOKLYN","QUEENS","QUEENS","BRONX","BROOKLYN","QUEENS","MANHATTAN","QUEENS","BROOKLYN","BRONX","MANHATTAN","BROOKLYN","BROOKLYN","QUEENS","QUEENS","STATEN ISLAND","MANHATTAN","MANHATTAN","STATEN ISLAND","BRONX","BRONX","QUEENS","BRONX","STATEN ISLAND","MANHATTAN","STATEN ISLAND","STATEN ISLAND","STATEN ISLAND","MANHATTAN","STATEN ISLAND","STATEN ISLAND","STATEN ISLAND","STATEN ISLAND","QUEENS","BROOKLYN","BROOKLYN","QUEENS","BRONX","MANHATTAN","MANHATTAN","BROOKLYN","QUEENS","STATEN ISLAND","BRONX","MANHATTAN","BROOKLYN","MANHATTAN","BROOKLYN","BRONX","BRONX","STATEN ISLAND","MANHATTAN","BRONX","QUEENS","BRONX","QUEENS","BROOKLYN","MANHATTAN","STATEN ISLAND","BROOKLYN","BROOKLYN","MANHATTAN","BRONX","BROOKLYN","QUEENS","STATEN ISLAND","BRONX","BROOKLYN","QUEENS","BROOKLYN","MANHATTAN","MANHATTAN","MANHATTAN","QUEENS","STATEN ISLAND"]},{"label":"Complaint Type","values":["Illegal Parking","Illegal Parking","Noise - Residential","Noise - Residential","HEAT/HOT WATER","Illegal Parking","Blocked Driveway","Noise - Residential","Illegal Parking","HEAT/HOT WATER","Blocked Driveway","Noise - Residential","HEAT/HOT WATER","Noise - Street/Sidewalk","Noise - Street/Sidewalk","UNSANITARY CONDITION","Noise - Street/Sidewalk","UNSANITARY CONDITION","HEAT/HOT WATER","Abandoned Vehicle","Blocked Driveway","Abandoned Vehicle","Noise - Street/Sidewalk","UNSANITARY CONDITION","Street Condition","Noise - Commercial","PLUMBING","Noise - Commercial","PLUMBING","Street Condition","UNSANITARY CONDITION","Noise - Commercial","Illegal Parking","PLUMBING","Street Condition","Noise - Residential","Abandoned Vehicle","Noise - Commercial","PLUMBING","Street Condition","Street Condition","Blocked Driveway","Abandoned Vehicle","Blocked Driveway","UNSANITARY CONDITION","Abandoned Vehicle","HEAT/HOT WATER","Noise - Street/Sidewalk","Noise - Commercial","PLUMBING","Street Condition","Street Condition","HEAT/HOT WATER","Street Condition","HEAT/HOT WATER","Street Condition","HEAT/HOT WATER","Street Condition","HEAT/HOT WATER","Street Condition","Street Condition","UNSANITARY CONDITION","UNSANITARY CONDITION","PLUMBING","PLUMBING","Noise - Residential","PLUMBING","HEAT/HOT WATER","Street Condition","UNSANITARY CONDITION","UNSANITARY CONDITION","Street Condition","PLUMBING","Noise - Residential","Noise - Street/Sidewalk","UNSANITARY CONDITION","Noise - Commercial","Noise - Street/Sidewalk","Noise - Commercial","Noise - Street/Sidewalk","Illegal Parking","Noise - Street/Sidewalk","PLUMBING","Illegal Parking","Street Condition","Illegal Parking","Abandoned Vehicle","Illegal Parking","Noise - Residential","Street Condition","Street Condition","Street Condition"]},{"label":"Agency","values":["New York City Police Department","New York City Police Department","New York City Police Department","New York City Police Department","Department of Housing Preservation and Development","New York City Police Department","New York City Police Department","New York City Police Department","New York City Police Department","Department of Housing Preservation and Development","New York City Police Department","New York City Police Department","Department of Housing Preservation and Development","New York City Police Department","New York City Police Department","Department of Housing Preservation and Development","New York City Police Department","Department of Housing Preservation and Development","Department of Housing Preservation and Development","New York City Police Department","New York City Police Department","New York City Police Department","New York City Police Department","Department of Housing Preservation and Development","Department of Transportation","New York City Police Department","Department of Housing Preservation and Development","New York City Police Department","Department of Housing Preservation and Development","Department of Transportation","Department of Housing Preservation and Development","New York City Police Department","New York City Police Department","Department of Housing Preservation and Development","Department of Transportation","New York City Police Department","New York City Police Department","New York City Police Department","Department of Housing Preservation and Development","Department of Transportation","Department of Transportation","New York City Police Department","New York City Police Department","New York City Police Department","Department of Housing Preservation and Development","New York City Police Department","Department of Housing Preservation and Development","New York City Police Department","New York City Police Department","Department of Housing Preservation and Development","Department of Transportation","Department of Transportation","Department of Housing Preservation and Development","Department of Transportation","Department of Housing Preservation and Development","Department of Transportation","Department of Housing Preservation and Development","Department of Transportation","Department of Housing Preservation and Development","Department of Transportation","Department of Transportation","Department of Housing Preservation and Development","Department of Housing Preservation and Development","Department of Housing Preservation and Development","Department of Housing Preservation and Development","New York City Police Department","Department of Housing Preservation and Development","Department of Housing Preservation and Development","Department of Transportation","Department of Housing Preservation and Development","Department of Housing Preservation and Development","Department of Transportation","Department of Housing Preservation and Development","New York City Police Department","New York City Police Department","Department of Housing Preservation and Development","New York City Police Department","New York City Police Department","New York City Police Department","New York City Police Department","New York City Police Department","New York City Police Department","Department of Housing Preservation and Development","New York City Police Department","Department of Transportation","New York City Police Department","New York City Police Department","New York City Police Department","New York City Police Department","Department of Transportation","Department of Transportation","Department of Transportation"]},{"label":"Status","values":["Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Pending","Open","Open","Open","Open","Pending","Open","Pending","Open","Pending","Pending","Open","Open","Open","Open","Unspecified","Open","Open","Open","Open","Open","Open","Open","Unspecified","Unspecified","Open","Unspecified","Unspecified","Unspecified","Unspecified","Unspecified","Unspecified","Open","Unspecified","Unspecified","Unspecified","Unspecified","Unspecified","Unspecified","In Progress","In Progress","Unspecified"]}],"counts":[375325,291038,218524,180208,177237,148651,140579,140433,138628,127163,126166,119839,113450,102041,83495,78493,73892,71408,67540,54787,51969,48307,47239,46802,45872,44689,44674,44000,37077,35053,33385,28813,27739,26864,23080,18408,17260,15720,15604,13857,13430,9119,8885,8426,5969,5841,5768,3622,2827,2821,1996,1256,1240,762,735,633,621,459,453,365,328,128,81,77,74,65,60,48,47,41,31,30,23,7,5,5,4,4,4,3,3,3,3,2,2,2,1,1,1,1,1,1],"line":{"color":[2,4,1,2,1,1,4,4,3,2,2,3,3,3,1,1,2,2,4,4,1,2,4,3,4,2,1,3,2,2,4,4,5,3,3,5,1,1,4,1,5,3,5,5,5,3,5,5,5,5,4,2,2,4,1,3,3,2,4,5,1,3,2,3,2,1,1,5,3,1,4,1,4,2,3,5,2,2,3,1,2,4,5,1,2,4,2,3,3,3,4,5],"colorscale":[[0,"#0072B2"],[0,"#0072B2"],[0.25,"#D55E00"],[0.25,"#D55E00"],[0.5,"#009E73"],[0.5,"#009E73"],[0.75,"#CC79A7"],[0.75,"#CC79A7"],[1,"#F0E442"],[1,"#F0E442"]],"cmin":1,"cmax":5,"showscale":false},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"parcats"}},"layout":{"width":1100,"height":650,"margin":{"b":30,"l":40,"t":60,"r":40},"title":{"text":"311 Complaint Flow: Borough → Type → Agency → Status (Colored by Borough)","x":0.02},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"arrangement":"freeform","dimensions":[{"label":"Borough","values":["BROOKLYN","QUEENS","BRONX","BROOKLYN","BRONX","BRONX","QUEENS","QUEENS","MANHATTAN","BROOKLYN","BROOKLYN","MANHATTAN","MANHATTAN","MANHATTAN","BRONX","BRONX","BROOKLYN","BROOKLYN","QUEENS","QUEENS","BRONX","BROOKLYN","QUEENS","MANHATTAN","QUEENS","BROOKLYN","BRONX","MANHATTAN","BROOKLYN","BROOKLYN","QUEENS","QUEENS","STATEN ISLAND","MANHATTAN","MANHATTAN","STATEN ISLAND","BRONX","BRONX","QUEENS","BRONX","STATEN ISLAND","MANHATTAN","STATEN ISLAND","STATEN ISLAND","STATEN ISLAND","MANHATTAN","STATEN ISLAND","STATEN ISLAND","STATEN ISLAND","STATEN ISLAND","QUEENS","BROOKLYN","BROOKLYN","QUEENS","BRONX","MANHATTAN","MANHATTAN","BROOKLYN","QUEENS","STATEN ISLAND","BRONX","MANHATTAN","BROOKLYN","MANHATTAN","BROOKLYN","BRONX","BRONX","STATEN ISLAND","MANHATTAN","BRONX","QUEENS","BRONX","QUEENS","BROOKLYN","MANHATTAN","STATEN ISLAND","BROOKLYN","BROOKLYN","MANHATTAN","BRONX","BROOKLYN","QUEENS","STATEN ISLAND","BRONX","BROOKLYN","QUEENS","BROOKLYN","MANHATTAN","MANHATTAN","MANHATTAN","QUEENS","STATEN ISLAND"]},{"label":"Complaint Type","values":["Illegal Parking","Illegal Parking","Noise - Residential","Noise - Residential","HEAT/HOT WATER","Illegal Parking","Blocked Driveway","Noise - Residential","Illegal Parking","HEAT/HOT WATER","Blocked Driveway","Noise - Residential","HEAT/HOT WATER","Noise - Street/Sidewalk","Noise - Street/Sidewalk","UNSANITARY CONDITION","Noise - Street/Sidewalk","UNSANITARY CONDITION","HEAT/HOT WATER","Abandoned Vehicle","Blocked Driveway","Abandoned Vehicle","Noise - Street/Sidewalk","UNSANITARY CONDITION","Street Condition","Noise - Commercial","PLUMBING","Noise - Commercial","PLUMBING","Street Condition","UNSANITARY CONDITION","Noise - Commercial","Illegal Parking","PLUMBING","Street Condition","Noise - Residential","Abandoned Vehicle","Noise - Commercial","PLUMBING","Street Condition","Street Condition","Blocked Driveway","Abandoned Vehicle","Blocked Driveway","UNSANITARY CONDITION","Abandoned Vehicle","HEAT/HOT WATER","Noise - Street/Sidewalk","Noise - Commercial","PLUMBING","Street Condition","Street Condition","HEAT/HOT WATER","Street Condition","HEAT/HOT WATER","Street Condition","HEAT/HOT WATER","Street Condition","HEAT/HOT WATER","Street Condition","Street Condition","UNSANITARY CONDITION","UNSANITARY CONDITION","PLUMBING","PLUMBING","Noise - Residential","PLUMBING","HEAT/HOT WATER","Street Condition","UNSANITARY CONDITION","UNSANITARY CONDITION","Street Condition","PLUMBING","Noise - Residential","Noise - Street/Sidewalk","UNSANITARY CONDITION","Noise - Commercial","Noise - Street/Sidewalk","Noise - Commercial","Noise - Street/Sidewalk","Illegal Parking","Noise - Street/Sidewalk","PLUMBING","Illegal Parking","Street Condition","Illegal Parking","Abandoned Vehicle","Illegal Parking","Noise - Residential","Street Condition","Street Condition","Street Condition"]},{"label":"Agency","values":["New York City Police Department","New York City Police Department","New York City Police Department","New York City Police Department","Department of Housing Preservation and Development","New York City Police Department","New York City Police Department","New York City Police Department","New York City Police Department","Department of Housing Preservation and Development","New York City Police Department","New York City Police Department","Department of Housing Preservation and Development","New York City Police Department","New York City Police Department","Department of Housing Preservation and Development","New York City Police Department","Department of Housing Preservation and Development","Department of Housing Preservation and Development","New York City Police Department","New York City Police Department","New York City Police Department","New York City Police Department","Department of Housing Preservation and Development","Department of Transportation","New York City Police Department","Department of Housing Preservation and Development","New York City Police Department","Department of Housing Preservation and Development","Department of Transportation","Department of Housing Preservation and Development","New York City Police Department","New York City Police Department","Department of Housing Preservation and Development","Department of Transportation","New York City Police Department","New York City Police Department","New York City Police Department","Department of Housing Preservation and Development","Department of Transportation","Department of Transportation","New York City Police Department","New York City Police Department","New York City Police Department","Department of Housing Preservation and Development","New York City Police Department","Department of Housing Preservation and Development","New York City Police Department","New York City Police Department","Department of Housing Preservation and Development","Department of Transportation","Department of Transportation","Department of Housing Preservation and Development","Department of Transportation","Department of Housing Preservation and Development","Department of Transportation","Department of Housing Preservation and Development","Department of Transportation","Department of Housing Preservation and Development","Department of Transportation","Department of Transportation","Department of Housing Preservation and Development","Department of Housing Preservation and Development","Department of Housing Preservation and Development","Department of Housing Preservation and Development","New York City Police Department","Department of Housing Preservation and Development","Department of Housing Preservation and Development","Department of Transportation","Department of Housing Preservation and Development","Department of Housing Preservation and Development","Department of Transportation","Department of Housing Preservation and Development","New York City Police Department","New York City Police Department","Department of Housing Preservation and Development","New York City Police Department","New York City Police Department","New York City Police Department","New York City Police Department","New York City Police Department","New York City Police Department","Department of Housing Preservation and Development","New York City Police Department","Department of Transportation","New York City Police Department","New York City Police Department","New York City Police Department","New York City Police Department","Department of Transportation","Department of Transportation","Department of Transportation"]},{"label":"Status","values":["Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Closed","Pending","Open","Open","Open","Open","Pending","Open","Pending","Open","Pending","Pending","Open","Open","Open","Open","Unspecified","Open","Open","Open","Open","Open","Open","Open","Unspecified","Unspecified","Open","Unspecified","Unspecified","Unspecified","Unspecified","Unspecified","Unspecified","Open","Unspecified","Unspecified","Unspecified","Unspecified","Unspecified","Unspecified","In Progress","In Progress","Unspecified"]}],"counts":[375325,291038,218524,180208,177237,148651,140579,140433,138628,127163,126166,119839,113450,102041,83495,78493,73892,71408,67540,54787,51969,48307,47239,46802,45872,44689,44674,44000,37077,35053,33385,28813,27739,26864,23080,18408,17260,15720,15604,13857,13430,9119,8885,8426,5969,5841,5768,3622,2827,2821,1996,1256,1240,762,735,633,621,459,453,365,328,128,81,77,74,65,60,48,47,41,31,30,23,7,5,5,4,4,4,3,3,3,3,2,2,2,1,1,1,1,1,1],"line":{"color":[2,4,1,2,1,1,4,4,3,2,2,3,3,3,1,1,2,2,4,4,1,2,4,3,4,2,1,3,2,2,4,4,5,3,3,5,1,1,4,1,5,3,5,5,5,3,5,5,5,5,4,2,2,4,1,3,3,2,4,5,1,3,2,3,2,1,1,5,3,1,4,1,4,2,3,5,2,2,3,1,2,4,5,1,2,4,2,3,3,3,4,5],"colorscale":[[0,"#0072B2"],[0,"#0072B2"],[0.25,"#D55E00"],[0.25,"#D55E00"],[0.5,"#009E73"],[0.5,"#009E73"],[0.75,"#CC79A7"],[0.75,"#CC79A7"],[1,"#F0E442"],[1,"#F0E442"]],"cmin":1,"cmax":5,"showscale":false},"type":"parcats","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<ul>
<li>Once we keep borough, detailed type (e.g.&nbsp;<em>Illegal Parking</em>, <em>Noise – Residential</em>), agency (NYPD, DOT, etc.), and status, the cross-tab becomes extremely high-dimensional.<br>
</li>
<li>A static plot would either hide most detail or be unreadable.<br>
</li>
<li>Interactivity (hovering to show labels and counts, highlighting a path) allows the reader to <strong>drill down</strong> without losing the full context.</li>
</ul>
<p><strong>How the interactivity helps</strong></p>
<ul>
<li>Hovering on <strong>Brooklyn → Illegal Parking</strong> reveals a very thick band flowing to <strong>NYPD</strong>, making it obvious that parking enforcement is overwhelmingly a police workload.<br>
</li>
<li>Highlighting <strong>Noise – Residential</strong> quickly shows which boroughs and agencies share that burden; for example, large flows from Queens and Brooklyn again route to NYPD.<br>
</li>
<li>Smaller but meaningful flows (for example, <em>HEAT/HOT WATER</em> to the housing agency) are easy to surface by hovering, even though they would be visually drowned out if everything were static.</li>
</ul>
<p>Instead of giving one fixed conclusion, this plot serves as a <strong>navigation map for responsibility</strong>: it lets a reader answer questions like <em>“Who usually deals with this type of complaint in my borough, and how does it tend to end?”</em>.</p>
</section>
<section id="where-problems-occur-and-what-type-of-complaints-are-occurring-there" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="where-problems-occur-and-what-type-of-complaints-are-occurring-there"><span class="header-section-number">3.6</span> 3.6 Where problems occur, and what type of complaints are occurring there?</h2>
<p>We next asked <strong>where</strong> in the city the problems are happening.<br>
We focused on the top location types (e.g., <em>RESIDENTIAL BUILDING</em>, <em>Street/Sidewalk</em>, <em>Store/Commercial</em>, <em>Club/Bar/Restaurant</em>) and the top complaint types.<br>
For each location, we computed the <strong>share of its complaints</strong> belonging to each type and plotted this as a <strong>heatmap</strong> with percentages printed on the tiles.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> df_clean_final <span class="sc">|&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">location_type  =</span> <span class="fu">str_squish</span>(location_type),</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">complaint_type =</span> <span class="fu">str_squish</span>(complaint_type)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(location_type), location_type <span class="sc">!=</span> <span class="st">""</span>,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(complaint_type), complaint_type <span class="sc">!=</span> <span class="st">""</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>top_loc <span class="ot">&lt;-</span> df1 <span class="sc">|&gt;</span> <span class="fu">count</span>(location_type, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(location_type)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>top_ct  <span class="ot">&lt;-</span> df1 <span class="sc">|&gt;</span> <span class="fu">count</span>(complaint_type, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">15</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(complaint_type)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>hm <span class="ot">&lt;-</span> df1 <span class="sc">|&gt;</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(location_type <span class="sc">%in%</span> top_loc, complaint_type <span class="sc">%in%</span> top_ct) <span class="sc">%&gt;%</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(location_type, complaint_type, <span class="at">name =</span> <span class="st">"n"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(location_type) <span class="sc">|&gt;</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">share =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">|&gt;</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="co"># --- STORY ORDERING (cluster rows/cols by similar composition) ---</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>mat_wide <span class="ot">&lt;-</span> hm <span class="sc">|&gt;</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(location_type, complaint_type, share) <span class="sc">|&gt;</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> complaint_type, <span class="at">values_from =</span> share, <span class="at">values_fill =</span> <span class="dv">0</span>)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(mat_wide[,<span class="sc">-</span><span class="dv">1</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>])</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mat) <span class="ot">&lt;-</span> mat_wide<span class="sc">$</span>location_type</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>row_ord <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(mat))<span class="sc">$</span>order</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>col_ord <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(<span class="fu">t</span>(mat)))<span class="sc">$</span>order</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>loc_levels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(mat)[row_ord]</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>ct_levels  <span class="ot">&lt;-</span> <span class="fu">colnames</span>(mat)[col_ord]</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>hm <span class="ot">&lt;-</span> hm <span class="sc">|&gt;</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">location_type  =</span> <span class="fu">factor</span>(location_type, <span class="at">levels =</span> loc_levels),</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">complaint_type =</span> <span class="fu">factor</span>(complaint_type, <span class="at">levels =</span> ct_levels),</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># label color for readability on dark vs light tiles</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">lbl_col =</span> <span class="fu">if_else</span>(share <span class="sc">&gt;=</span> <span class="fl">0.45</span>, <span class="st">"black"</span>, <span class="st">"white"</span>)</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(hm, <span class="fu">aes</span>(<span class="at">x =</span> complaint_type, <span class="at">y =</span> location_type, <span class="at">fill =</span> share)) <span class="sc">+</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">percent</span>(share, <span class="at">accuracy =</span> <span class="dv">1</span>), <span class="at">color =</span> lbl_col),</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">3.3</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_identity</span>() <span class="sc">+</span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">option =</span> <span class="st">"plasma"</span>,   <span class="co"># high-contrast, story-friendly</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">begin =</span> <span class="fl">0.08</span>, <span class="at">end =</span> <span class="fl">0.98</span>,</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>),</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Share"</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Complaint Composition by Location Type"</span>,</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Within each location type, tiles show the share of complaints by complaint type (clustered to reveal similar patterns)"</span>,</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Complaint Type (top 15)"</span>,</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Location Type (top 10)"</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">35</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="results_shweta_files/figure-html/label- heatmap-location-complaint-better, fig-width- 12, fig-height- 7-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Location × complaint type is a dense matrix; heatmaps excel at summarising many cells using colour.<br>
</li>
<li>Embedding the percentages directly gives precise values without forcing the reader to flip back to a legend.</li>
</ul>
<p><strong>Patterns by location</strong></p>
<ul>
<li>For <strong>Residential Building/House</strong>, complaints are heavily concentrated in a few types — particularly <em>HEAT/HOT WATER</em> and indoor cleanliness conditions — which often take up essentially the entire row.<br>
</li>
<li><strong>Street/Sidewalk</strong> is dominated by <em>Illegal Parking</em>, <em>Abandoned Vehicles</em>, and outdoor sanitation issues.<br>
</li>
<li>Commercial spaces (<em>Store/Commercial</em>, <em>Club/Bar/Restaurant</em>) are almost entirely noise and cleanliness problems.</li>
</ul>
<p>This figure supports simple, concrete statements such as:<br>
&gt; “On streets and sidewalks, the story is mostly about parking and trash; inside homes, it’s about heat, water, and living conditions.”</p>
<section id="resolution-actions-by-location-type-faceted-bar-charts" class="level4" data-number="3.6.0.1">
<h4 data-number="3.6.0.1" class="anchored" data-anchor-id="resolution-actions-by-location-type-faceted-bar-charts"><span class="header-section-number">3.6.0.1</span> 3.6.2 Resolution actions by location type (faceted bar charts)</h4>
<p>We then looked at <strong>what kind of action</strong> is actually taken, and <strong>where</strong>.<br>
We grouped individual resolution descriptions into a handful of broader <strong>action types</strong> (e.g., <em>Duplicate / Already Reported</em>, <em>Enforcement / Summons</em>, <em>Inspection / Investigation</em>, <em>Referred / Transferred</em>, <em>Work Completed</em>).<br>
For each action type, we plotted a <strong>bar chart showing the share of that action occurring in each location type</strong>, with one small panel per action.<br>
We excluded “No Issue Found” so the panels focus on cases where something concrete happened.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1) Prep + tag resolution actions (same logic you used) ---</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> df_clean_final <span class="sc">|&gt;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">location_type =</span> <span class="fu">str_squish</span>(location_type),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">resolution_description =</span> <span class="fu">str_squish</span>(resolution_description)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(location_type), location_type <span class="sc">!=</span> <span class="st">""</span>,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(resolution_description), resolution_description <span class="sc">!=</span> <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rd =</span> <span class="fu">str_to_lower</span>(resolution_description)) <span class="sc">|&gt;</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">action_tag =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(rd, <span class="st">"inspect|inspection|investigat|observ"</span>) <span class="sc">~</span> <span class="st">"Inspection / Investigation"</span>,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(rd, <span class="st">"no violation|unable to observe|could not.*verify"</span>) <span class="sc">~</span> <span class="st">"No Issue Found"</span>,</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(rd, <span class="st">"duplicate|already reported|previously reported"</span>) <span class="sc">~</span> <span class="st">"Duplicate / Already Reported"</span>,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(rd, <span class="st">"summons|ticket|violation issued|enforc"</span>) <span class="sc">~</span> <span class="st">"Enforcement / Summons"</span>,</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(rd, <span class="st">"repaired|fixed|completed|work order|restored|cleaned"</span>) <span class="sc">~</span> <span class="st">"Work Completed"</span>,</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(rd, <span class="st">"referred|transfer|forwarded|sent to"</span>) <span class="sc">~</span> <span class="st">"Referred / Transferred"</span>,</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other Action"</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chunk 2: plot (uses df3 from above)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>top_loc <span class="ot">&lt;-</span> df3 <span class="sc">|&gt;</span> <span class="fu">count</span>(location_type, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(location_type)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>df3_f <span class="ot">&lt;-</span> df3 <span class="sc">|&gt;</span> <span class="fu">filter</span>(action_tag <span class="sc">!=</span> <span class="st">"No Issue Found"</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>action_loc <span class="ot">&lt;-</span> df3_f <span class="sc">|&gt;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(location_type <span class="sc">%in%</span> top_loc) <span class="sc">|&gt;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(action_tag, location_type, <span class="at">name =</span> <span class="st">"n"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(action_tag) <span class="sc">|&gt;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">share_within_action =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">|&gt;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- ONLY change: sort x within each facet by share ----</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>action_loc <span class="ot">&lt;-</span> action_loc <span class="sc">|&gt;</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(action_tag) <span class="sc">|&gt;</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(share_within_action), <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">location_type_sorted =</span> <span class="fu">factor</span>(location_type, <span class="at">levels =</span> <span class="fu">unique</span>(location_type))) <span class="sc">|&gt;</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(action_loc, <span class="fu">aes</span>(<span class="at">x =</span> location_type_sorted, <span class="at">y =</span> share_within_action, <span class="at">fill =</span> action_tag)) <span class="sc">+</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.82</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> action_tag, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set2"</span>, <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Resolution Actions by Location Type (Faceted)"</span>,</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Excludes “No Issue Found”. Each panel shows where that action occurs most (shares sum to 100% within each action)."</span>,</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Share within action"</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">35</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="fl">1.1</span>, <span class="st">"lines"</span>),</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ---- ONLY change: prevent facet titles from being cut ----</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">20</span>, <span class="at">r =</span> <span class="dv">15</span>, <span class="at">b =</span> <span class="dv">25</span>, <span class="at">l =</span> <span class="dv">15</span>)</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="results_shweta_files/figure-html/label- action-taxonomy-location,fig-height- 7-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Conditioning on the action (“given that an action of type X happened, where did it happen?”) is a different question from the previous heatmap.<br>
</li>
<li>Faceting by action keeps each panel simple and lets us scan across panels to see which locations dominate which actions.</li>
</ul>
<p><strong>What the panels reveal</strong></p>
<ul>
<li><strong>Duplicate / Already Reported</strong> is almost entirely associated with <em>Street/Sidewalk</em>, suggesting repeated reports from passers-by at the same spot.<br>
</li>
<li><strong>Enforcement / Summons</strong> is heavily concentrated in public space (street, sidewalk, above-address), aligning with ticketing and code enforcement.<br>
</li>
<li><strong>Inspection / Investigation</strong> is skewed towards <em>RESIDENTIAL BUILDING</em>, which is exactly where we’d expect inspectors to be dispatched.<br>
</li>
<li><strong>Work Completed</strong> shows a mix of residential and street locations, highlighting where city crews most often finish tangible tasks.</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./data.html" class="pagination-link" aria-label="Data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./conclusion.html" class="pagination-link" aria-label="Conclusion">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Conclusion</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://shweta-3001.github.io/Group-15-NYC-311-Request-Edav-Project/edit/main/results_shweta.qmd" class="toc-action"><i class="bi bi-git"></i>Edit this page</a></li><li><a href="https://shweta-3001.github.io/Group-15-NYC-311-Request-Edav-Project/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>